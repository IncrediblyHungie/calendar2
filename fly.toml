app = "hunkofthemonth"
primary_region = "sjc"

[build]
  # Uses Nixpacks to auto-detect Flask

[env]
  PORT = "8080"
  FLASK_ENV = "production"

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = "suspend"     # Suspend instead of stop (faster wake-up)
  auto_start_machines = true
  min_machines_running = 1           # Keep 1 machine always running (no cold starts)
  processes = ["app"]

  [http_service.concurrency]
    type = "connections"
    hard_limit = 100                 # Gunicorn can handle 100 connections per machine
    soft_limit = 80                  # Start new machine at 80 concurrent connections

[[vm]]
  memory = '2048mb'  # Upgraded from 512mb to 2GB
  cpu_kind = 'shared'
  cpus = 4  # Upgraded from 1 to 4 CPUs for parallel processing

# Persistent volume for session storage
[mounts]
  source = "session_storage"
  destination = "/data"

# Static file serving (optional, most will be on Vercel)
[[statics]]
  guest_path = "/app/app/static"
  url_prefix = "/static"

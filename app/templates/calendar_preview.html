{% extends "base.html" %}

{% block title %}Calendar Grid Preview{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Progress Steps -->
    <div class="progress-steps mb-5">
        <div class="step completed">
            <div class="step-number"><i class="fas fa-check"></i></div>
            <div class="step-label">Upload Photos</div>
        </div>
        <div class="step completed">
            <div class="step-number"><i class="fas fa-check"></i></div>
            <div class="step-label">Review Themes</div>
        </div>
        <div class="step completed">
            <div class="step-number"><i class="fas fa-check"></i></div>
            <div class="step-label">Generate</div>
        </div>
        <div class="step active">
            <div class="step-number">4</div>
            <div class="step-label">Preview</div>
        </div>
    </div>

    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="display-4 mb-3">
            <i class="fas fa-calendar-alt text-danger me-2"></i>
            Your Complete Calendar Preview
        </h1>
        <p class="lead text-muted">
            All 12 months at a glance - See your hunky transformations for the entire year!
        </p>
    </div>

    <!-- Calendar Grid Preview Card -->
    <div class="card shadow-lg mb-5">
        <div class="card-body p-4">
            <div class="calendar-grid-container text-center">
                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
                        <span class="visually-hidden">Loading calendar preview...</span>
                    </div>
                    <p class="mt-3 text-muted">Generating your calendar preview...</p>
                </div>

                <!-- Grid Image (3×4 layout) -->
                <img id="calendarGrid"
                     src="{{ url_for('api.calendar_grid_image') }}"
                     alt="Calendar Grid Preview - All 12 Months"
                     class="img-fluid rounded shadow"
                     style="max-width: 100%; height: auto; display: none;">
            </div>

            <!-- Grid Info -->
            <div class="mt-4 text-center">
                <p class="text-muted mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>3×4 Grid Layout:</strong> January-April (top row), May-August (middle), September-December (bottom)
                </p>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <a href="{{ url_for('projects.preview') }}" class="btn btn-outline-secondary w-100">
                <i class="fas fa-th me-2"></i>
                View Individual Months
            </a>
        </div>
        <div class="col-md-4">
            <a href="{{ url_for('api.calendar_grid_image') }}"
               download="calendar_preview.jpg"
               class="btn btn-outline-primary w-100">
                <i class="fas fa-download me-2"></i>
                Download Preview
            </a>
        </div>
        <div class="col-md-4">
            <a href="{{ url_for('projects.checkout') }}" class="btn btn-success w-100">
                <i class="fas fa-shopping-cart me-2"></i>
                Order Calendar
            </a>
        </div>
    </div>

    <!-- Back to Preview -->
    <div class="text-center">
        <a href="{{ url_for('projects.preview') }}" class="btn btn-link">
            <i class="fas fa-arrow-left me-2"></i>
            Back to Interactive Preview
        </a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Show image when loaded, hide spinner
document.addEventListener('DOMContentLoaded', () => {
    const gridImage = document.getElementById('calendarGrid');
    const spinner = document.getElementById('loadingSpinner');

    gridImage.addEventListener('load', () => {
        spinner.style.display = 'none';
        gridImage.style.display = 'block';

        // Smooth scroll to image
        setTimeout(() => {
            gridImage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
    });

    gridImage.addEventListener('error', () => {
        spinner.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Failed to load calendar preview. Please try again.
            </div>
        `;
    });
});
</script>

<style>
/* Calendar grid container styling */
.calendar-grid-container {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 2rem;
    border-radius: 1rem;
}

/* Responsive grid image */
#calendarGrid {
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
}

#calendarGrid:hover {
    transform: scale(1.02);
}

/* Progress steps styling */
.progress-steps {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 3rem;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.step-number {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #e9ecef;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
}

.step.completed .step-number {
    background: #198754;
    color: white;
}

.step.active .step-number {
    background: #0d6efd;
    color: white;
    animation: pulse 2s infinite;
}

.step-label {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 500;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .calendar-grid-container {
        padding: 1rem;
    }

    .progress-steps {
        gap: 1rem;
        font-size: 0.8rem;
    }

    .step-number {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
}
</style>
{% endblock %}
